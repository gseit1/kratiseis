<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="../styles/admin.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel</title>
</head>

<body>
    <div class="container mt-5">
        <h1 class="text-center">Admin Panel</h1>
        
        <!-- Categories Section -->
        <div class="mb-4">
            <h2>Categories</h2>
            <form id="categoryForm" class="mb-3">
                <input type="text" id="categoryName" class="form-control" placeholder="Category Name">
                <input type="text" id="categoryImage" class="form-control mt-2" placeholder="Category Image URL">
                <input type="text" id="categoryBanner" class="form-control mt-2" placeholder="Category Banner URL">
                <button type="submit" class="btn btn-primary mt-2">Add Category</button>
            </form>
            <ul id="categoryList" class="list-group">
                <!-- Categories will be dynamically inserted here -->
            </ul>
        </div>

        <!-- Cities Section -->
        <div class="mb-4">
            <h2>Cities</h2>
            <form id="cityForm" class="mb-3">
                <input type="text" id="cityName" class="form-control" placeholder="City Name">
                <button type="submit" class="btn btn-primary mt-2">Add City</button>
            </form>
            <ul id="cityList" class="list-group">
                <!-- Cities will be dynamically inserted here -->
            </ul>
        </div>

        <!-- Regions Section -->
        <div class="mb-4">
            <h2>Regions</h2>
            <form id="regionForm" class="mb-3">
                <input type="text" id="regionName" class="form-control" placeholder="Region Name">
                <button type="submit" class="btn btn-primary mt-2">Add Region</button>
            </form>
            <ul id="regionList" class="list-group">
                <!-- Regions will be dynamically inserted here -->
            </ul>
        </div>
    </div>

    <script>
        async function fetchCategories() {
            try {
                const response = await fetch('/category');
                const data = await response.json();
                const categoryList = document.getElementById('categoryList');
                categoryList.innerHTML = '';
                data.categories.forEach(category => {
                    const li = document.createElement('li');
                    li.className = 'list-group-item d-flex justify-content-between align-items-center';
                    li.innerHTML = `
                        ${category.name}
                        <div>
                            <button class="btn btn-sm btn-warning" onclick="editCategory('${category._id}', '${category.name}', '${category.image}', '${category.banner}')">Edit</button>
                            <button class="btn btn-sm btn-danger" onclick="deleteCategory('${category._id}')">Delete</button>
                        </div>
                    `;
                    categoryList.appendChild(li);
                });
            } catch (error) {
                console.error('Error fetching categories:', error);
            }
        }

        async function fetchCities() {
            try {
                const response = await fetch('/city');
                const data = await response.json();
                const cityList = document.getElementById('cityList');
                cityList.innerHTML = '';
                data.forEach(city => {
                    const li = document.createElement('li');
                    li.className = 'list-group-item d-flex justify-content-between align-items-center';
                    li.innerHTML = `
                        ${city.name}
                        <div>
                            <button class="btn btn-sm btn-warning" onclick="editCity('${city._id}', '${city.name}')">Edit</button>
                            <button class="btn btn-sm btn-danger" onclick="deleteCity('${city._id}')">Delete</button>
                        </div>
                    `;
                    cityList.appendChild(li);
                });
            } catch (error) {
                console.error('Error fetching cities:', error);
            }
        }

        async function fetchRegions() {
            try {
                const response = await fetch('/region');
                const data = await response.json();
                const regionList = document.getElementById('regionList');
                regionList.innerHTML = '';
                data.regions.forEach(region => {
                    const li = document.createElement('li');
                    li.className = 'list-group-item d-flex justify-content-between align-items-center';
                    li.innerHTML = `
                        ${region.name}
                        <div>
                            <button class="btn btn-sm btn-warning" onclick="editRegion('${region._id}', '${region.name}')">Edit</button>
                            <button class="btn btn-sm btn-danger" onclick="deleteRegion('${region._id}')">Delete</button>
                        </div>
                    `;
                    regionList.appendChild(li);
                });
            } catch (error) {
                console.error('Error fetching regions:', error);
            }
        }

        async function addCategory(event) {
            event.preventDefault();
            const categoryName = document.getElementById('categoryName').value;
            const categoryImage = document.getElementById('categoryImage').value;
            const categoryBanner = document.getElementById('categoryBanner').value;
            if (!categoryName || !categoryImage || !categoryBanner) {
                alert('All fields are required');
                return;
            }
            try {
                await fetch('/category', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ name: categoryName, image: categoryImage, banner: categoryBanner })
                });
                document.getElementById('categoryName').value = '';
                document.getElementById('categoryImage').value = '';
                document.getElementById('categoryBanner').value = '';
                fetchCategories();
            } catch (error) {
                console.error('Error adding category:', error);
            }
        }

        async function addCity(event) {
            event.preventDefault();
            const cityName = document.getElementById('cityName').value;
            if (!cityName) {
                alert('City name cannot be empty');
                return;
            }
            try {
                await fetch('/city', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ name: cityName })
                });
                document.getElementById('cityName').value = '';
                fetchCities();
            } catch (error) {
                console.error('Error adding city:', error);
            }
        }

        async function addRegion(event) {
            event.preventDefault();
            const regionName = document.getElementById('regionName').value;
            if (!regionName) {
                alert('Region name cannot be empty');
                return;
            }
            try {
                await fetch('/region', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ name: regionName })
                });
                document.getElementById('regionName').value = '';
                fetchRegions();
            } catch (error) {
                console.error('Error adding region:', error);
            }
        }

        async function editCategory(id, name, image, banner) {
            const newName = prompt('Enter new category name:', name);
            const newImage = prompt('Enter new category image URL:', image);
            const newBanner = prompt('Enter new category banner URL:', banner);
            if (newName && newImage && newBanner && (newName !== name || newImage !== image || newBanner !== banner)) {
                try {
                    await fetch(`/category/${id}`, {
                        method: 'PATCH',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ name: newName, image: newImage, banner: newBanner })
                    });
                    fetchCategories();
                } catch (error) {
                    console.error('Error editing category:', error);
                }
            }
        }

        async function editCity(id, name) {
            const newName = prompt('Enter new city name:', name);
            if (newName && newName !== name) {
                try {
                    await fetch(`/city/${id}`, {
                        method: 'PATCH',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ name: newName })
                    });
                    fetchCities();
                } catch (error) {
                    console.error('Error editing city:', error);
                }
            }
        }

        async function editRegion(id, name) {
            const newName = prompt('Enter new region name:', name);
            if (newName && newName !== name) {
                try {
                    await fetch(`/region/${id}`, {
                        method: 'PATCH',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ name: newName })
                    });
                    fetchRegions();
                } catch (error) {
                    console.error('Error editing region:', error);
                }
            }
        }

        async function deleteCategory(id) {
            if (confirm('Are you sure you want to delete this category?')) {
                try {
                    await fetch(`/category/${id}`, {
                        method: 'DELETE'
                    });
                    fetchCategories();
                } catch (error) {
                    console.error('Error deleting category:', error);
                }
            }
        }

        async function deleteCity(id) {
            if (confirm('Are you sure you want to delete this city?')) {
                try {
                    await fetch(`/city/${id}`, {
                        method: 'DELETE'
                    });
                    fetchCities();
                } catch (error) {
                    console.error('Error deleting city:', error);
                }
            }
        }

        async function deleteRegion(id) {
            if (confirm('Are you sure you want to delete this region?')) {
                try {
                    await fetch(`/region/${id}`, {
                        method: 'DELETE'
                    });
                    fetchRegions();
                } catch (error) {
                    console.error('Error deleting region:', error);
                }
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            fetchCategories();
            fetchCities();
            fetchRegions();

            document.getElementById('categoryForm').addEventListener('submit', addCategory);
            document.getElementById('cityForm').addEventListener('submit', addCity);
            document.getElementById('regionForm').addEventListener('submit', addRegion);
        });
    </script>
</body>
</html>