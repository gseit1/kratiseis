<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="../styles/customer.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register/Login</title>
    <script type="module">
        // Login still uses Firebase Auth, so keep these imports
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";

        // Firebase configuration (needed for login)
        const firebaseConfig = {
            apiKey: "AIzaSyD6yfJs_ICEC_M0lJvl3Q5_nTIbF-1nLOc",
            authDomain: "fir-authforbackend.firebaseapp.com",
            projectId: "fir-authforbackend",
            storageBucket: "fir-authforbackend.firebasestorage.app",
            messagingSenderId: "952057050344",
            appId: "1:952057050344:web:ea524c209b6a29b1a0c55d"
        };

        // Initialize Firebase for login
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);

        // Registration form submission (now sends data to your backend)
        document.getElementById('registerForm').addEventListener('submit', async function(event) {
            event.preventDefault();

            const name = document.getElementById('name').value;
            const surname = document.getElementById('surname').value;
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            try {
                // Send registration data to your backend
                const response = await fetch('/api/signup', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        name: name,
                        surname: surname,
                        email: email,
                        password: password
                    })
                });

                const result = await response.json();
                
                if (response.ok) {
                    alert('Registration successful!');
                } else {
                    alert('Error: ' + result.message); // Show backend error
                }
            } catch (error) {
                console.error('Error registering:', error);
                alert('Error registering: ' + error.message);
            }
        });





        // Login form submission (unchanged)
        document.getElementById('loginForm').addEventListener('submit', async function (event) {
  event.preventDefault();

  const email = document.getElementById('loginEmail').value;
  const password = document.getElementById('loginPassword').value;

  try {
    // Κάνε login και πάρε το token, τον ρόλο και το shopId
    const response = await fetch('/api/login', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({ email, password }),
    });

    const result = await response.json();
    console.log('Login response:', result);

    if (response.ok) {
      // Αποθήκευση του token στο localStorage
      localStorage.setItem('jwtToken', result.idToken);

      // Ανακατεύθυνση ανάλογα με τον ρόλο
      if (result.role === 'user') {
        window.location.href = 'index.html'; // Αρχική σελίδα για χρήστες
      } else if (result.role === 'shopOwner') {
        if (result.shopId) {
          window.location.href = `shopOwnerDashboard.html?shop_id=${result.shopId}`; // Σελίδα μαγαζιού
        } else {
          alert('No shop associated with this shop owner.');
        }
      } else if (result.role === 'admin') {
        window.location.href = 'admin.html'; // Σελίδα διαχειριστή
      } else {
        alert('Unknown role!');
      }
    } else {
      alert('Login failed: ' + result.message);
    }
  } catch (error) {
    console.error('Error logging in:', error);
    alert('Error logging in: ' + error.message);
  }
});
    </script>
</head>
<body>
    <div class="container mt-5">
        <h1 class="text-center">Register</h1>
        <form id="registerForm" class="mx-auto" style="max-width: 600px;">
            <div class="mb-3">
                <label for="name" class="form-label">Name:</label>
                <input type="text" class="form-control" id="name" name="name" required>
            </div>
            <div class="mb-3">
                <label for="surname" class="form-label">Surname:</label>
                <input type="text" class="form-control" id="surname" name="surname" required>
            </div>
            <div class="mb-3">
                <label for="email" class="form-label">Email:</label>
                <input type="email" class="form-control" id="email" name="email" required>
            </div>
            <div class="mb-3">
                <label for="password" class="form-label">Password:</label>
                <input type="password" class="form-control" id="password" name="password" required>
            </div>
            <button type="submit" class="btn btn-primary">Register</button>
        </form>

        <h1 class="text-center mt-5">Login</h1>
        <form id="loginForm" class="mx-auto" style="max-width: 600px;">
            <div class="mb-3">
                <label for="loginEmail" class="form-label">Email:</label>
                <input type="email" class="form-control" id="loginEmail" name="email" required>
            </div>
            <div class="mb-3">
                <label for="loginPassword" class="form-label">Password:</label>
                <input type="password" class="form-control" id="loginPassword" name="password" required>
            </div>
            <button type="submit" class="btn btn-primary">Login</button>
        </form>
    </div>
</body>
</html>