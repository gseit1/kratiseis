<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="../styles/customer.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register/Login</title>
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

        // Your Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyB2PuQk5934f6_86hopJl3pdasOmCON_3U",
            authDomain: "magaziaestiasi.firebaseapp.com",
            projectId: "magaziaestiasi",
            storageBucket: "magaziaestiasi.appspot.com",
            messagingSenderId: "194228374674",
            appId: "1:194228374674:web:fe71e120ffa91f7db72a4b",
            measurementId: "G-BM1N63R3D3"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        document.getElementById('registerForm').addEventListener('submit', async function(event) {
            event.preventDefault();

            const fullName = document.getElementById('fullName').value;
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            try {
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;

                // Add user to Firestore with role
                await setDoc(doc(db, 'users', user.uid), {
                    fullName: fullName,
                    email: email,
                    role: 'user' // Default role
                });

                alert('Registration successful!');
            } catch (error) {
                console.error('Error registering:', error);
                alert('Error registering: ' + error.message);
            }
        });

        document.getElementById('loginForm').addEventListener('submit', async function(event) {
            event.preventDefault();

            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            try {
                await signInWithEmailAndPassword(auth, email, password);
                alert('Login successful!');
                window.location.href = 'index.html';
            } catch (error) {
                console.error('Error logging in:', error);
                alert('Error logging in: ' + error.message);
            }
        });
    </script>
</head>
<body>
    <div class="container mt-5">
        <h1 class="text-center">Register</h1>
        <form id="registerForm" class="mx-auto" style="max-width: 600px;">
            <div class="mb-3">
                <label for="fullName" class="form-label">Full Name:</label>
                <input type="text" class="form-control" id="fullName" name="fullName" required>
            </div>
            <div class="mb-3">
                <label for="email" class="form-label">Email:</label>
                <input type="email" class="form-control" id="email" name="email" required>
            </div>
            <div class="mb-3">
                <label for="password" class="form-label">Password:</label>
                <input type="password" class="form-control" id="password" name="password" required>
            </div>
            <button type="submit" class="btn btn-primary">Register</button>
        </form>

        <h1 class="text-center mt-5">Login</h1>
        <form id="loginForm" class="mx-auto" style="max-width: 600px;">
            <div class="mb-3">
                <label for="loginEmail" class="form-label">Email:</label>
                <input type="email" class="form-control" id="loginEmail" name="email" required>
            </div>
            <div class="mb-3">
                <label for="loginPassword" class="form-label">Password:</label>
                <input type="password" class="form-control" id="loginPassword" name="password" required>
            </div>
            <button type="submit" class="btn btn-primary">Login</button>
        </form>
    </div>
</body>
</html>